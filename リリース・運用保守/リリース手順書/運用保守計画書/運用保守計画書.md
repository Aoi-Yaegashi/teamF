# シンプル雑貨オンライン Web アプリケーション 運用保守計画書

## 1. 文書情報

| 項目                 | 内容                                   |
| :------------------- | :------------------------------------- |
| **文書名** | シンプル雑貨オンライン Web アプリケーション 運用保守計画書 |
| **文書バージョン** | 1.0                                    |
| **作成日** | 2025年04月14日                         |
| **作成者** | (担当者名)                             |
| **最終更新日** | 2025年04月14日                         |
| **最終更新者** | (担当者名)                             |
| **対象システム** | シンプル雑貨オンライン Web アプリケーション v1.0.0 |
| **対象システム概要** | シンプルな雑貨を販売するECサイト       |
| **関連ドキュメント** | リリース手順書 Ver.1.0, システム構成図 Ver.1.0, 障害対応手順書 Ver.1.0 (予定) |

## 2. 運用保守体制

| 役割                 | 担当者/チーム | 所属       | 連絡先 (例: 内線/Chat ID) | 主な役割                                                                         |
| :------------------- | :------------ | :--------- | :------------------------ | :------------------------------------------------------------------------------- |
| **運用保守責任者** | (氏名A)       | (開発部)   | 1234 / userA              | 運用保守全体の統括、重要判断、関係部署調整                                         |
| **一次対応窓口** | 開発チーム    | (開発部)   | [メールアドレスを削除しました]      | ユーザー問合せ受付、障害検知、一次切り分け、チケット起票、担当割り振り             |
| **アプリケーション担当** | 開発チーム    | (開発部)   | [メールアドレスを削除しました]      | アプリケーション障害調査・復旧、バグ修正、機能追加・改善、セキュリティ対応(App)     |
| **インフラ担当** | (氏名C)       | (インフラ部)| 1236 / userC              | サーバー/NW/DB監視・障害対応、バックアップ、OS/MWパッチ適用、リソース管理           |

**連絡体制:**

  - **平日日中 (9:00-18:00 JST)**:
      - ユーザーからの問い合わせ/障害報告 → 一次対応窓口 (開発チーム)
      - 監視アラート検知 → 一次対応窓口 (開発チーム) → 必要に応じて担当 (App/Infra) へエスカレーション
  - **夜間・休日**:
      - 監視アラート検知 (緊急度: 高) → 運用保守責任者 (氏名A) へ自動通知 → 責任者が担当者 (App/Infra) へ連絡・指示
      - ユーザーからの緊急連絡 → (別途定める緊急連絡窓口経由で) 運用保守責任者へ連絡
  - **エスカレーションルール**:
      - 一次対応で解決しない場合、担当 (App/Infra) へチケットで引き継ぎ。
      - 重大障害発生時、または復旧に時間がかかると判断される場合は、速やかに運用保守責任者へ報告。

**利用ツール (例):**

  - **チケット管理**: Backlog
  - **監視**: Zabbix
  - **ログ管理**: Elasticsearch/Kibana
  - **情報共有**: Slack、社内Wiki

## 3. サービスレベル目標 (SLA)

本システムの安定稼働とサービス品質維持のため、以下の目標値を設定する。

| 項目                                   | 目標値             | 測定方法                                                                                                  |
| :------------------------------------- | :----------------- | :-------------------------------------------------------------------------------------------------------- |
| **サービス稼働率 (月間)** | 99.5% 以上         | 監視ツールによるURL外形監視 (`/`) の結果に基づき算出 (計画停止時間を除く)                                   |
| **主要API平均応答時間** | 500ms 以下         | 監視ツールによる `/api/products`, `/api/cart`, `/api/orders` の平均応答時間 (直近1時間)                       |
| **障害検知から一次対応開始までの時間** | 平日日中: 30分以内 <br> 夜間休日: 60分以内 | チケット起票時刻と担当者による対応開始コメント時刻の差                                                        |
| **重大障害からの復旧目標時間 (RTO)** | 4時間以内          | 障害発生時刻 (または検知時刻) からサービス復旧宣言時刻までの時間 (障害レベル: 重大 の場合)                |
| **データ損失目標 (RPO)** | 24時間以内         | データベースの日次バックアップを基準とする                                                              |

## 4. 運用業務

システムの安定稼働を維持するための日常業務として以下を行なう。

### 4.1. 監視

| 監視対象       | 項目                                                                   | 監視ツール | 監視間隔 | 閾値/検知条件                                                                                                                                                                                                 | アラート通知先                                                                                                                                                                                             |
| :------------- | :--------------------------------------------------------------------- | :--------- | :------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **App Server** | Ping死活                                                               | Zabbix     | 1分      | 3回連続失敗                                                                                                                                                                                                   | 一次対応窓口, Infra担当C                                                                                                                                                                                      |
|                | ポート応答 (8080/TCP)                                                  | Zabbix     | 1分      | 応答なし                                                                                                                                                                                                      | 一次対応窓口, Infra担当C                                                                                                                                                                                      |
|                | プロセス死活 (`java` ... `simplezakka`)                                | Zabbix     | 1分      | プロセス数=0                                                                                                                                                                                                    | 一次対応窓口, App担当                                                                                                                                                                                        |
|                | CPU使用率                                                              | Zabbix     | 5分      | 80% 超過 (5分継続)                                                                                                                                                                                              | 一次対応窓口, Infra担当C                                                                                                                                                                                      |
|                | メモリ使用率                                                           | Zabbix     | 5分      | 85% 超過 (5分継続)                                                                                                                                                                                              | 一次対応窓口, Infra担当C                                                                                                                                                                                      |
|                | ディスク空き容量 (`/`, `/path/to/logs`)                                   | Zabbix     | 1時間    | 空き容量 10% 未満                                                                                                                                                                                             | 一次対応窓口, Infra担当C                                                                                                                                                                                      |
| **DB Server** | Ping死活                                                               | Zabbix     | 1分      | 3回連続失敗                                                                                                                                                                                                   | 一次対応窓口, Infra担当C                                                                                                                                                                                      |
|                | ポート応答 (MySQL:3306/TCP)                                             | Zabbix     | 1分      | 応答なし                                                                                                                                                                                                      | 一次対応窓口, Infra担当C                                                                                                                                                                                      |
|                | CPU/メモリ/ディスク                                                    | Zabbix     | 5分      | App Serverに準ずる                                                                                                                                                                                            | 一次対応窓口, Infra担当C                                                                                                                                                                                      |
| **App Service**| URL外形監視 (`/`)                                                      | Zabbix     | 1分      | HTTPステータス \!= 200 <br> または 応答本文に "シンプル雑貨オンライン" が含まれない場合                                                                                                                                | 一次対応窓口, App担当                                                                                                                                                                                        |
|                | URL外形監視 (`/api/products`)                                          | Zabbix     | 1分      | HTTPステータス \!= 200 <br> または 応答JSONに `productId` が含まれない場合                                                                                                                                        | 一次対応窓口, App担当                                                                                                                                                                                        |
|                | API応答時間 (`/api/*`)                                                 | Zabbix     | 5分      | 平均応答時間 \> 500ms (1時間継続)                                                                                                                                                                              | 一次対応窓口, App担当                                                                                                                                                                                        |
| **Logs** | Appログ (`/path/to/logs/app*.log`)                                       | ELK/Filebeat | 随時     | "ERROR" レベルのログが出力された場合                                                                                                                                                                        | 一次対応窓口, App担当                                                                                                                                                                                        |
|                | DBエラーログ                                                           | Zabbix Agent| 随時     | "Error", "Warning" レベルのログが出力された場合                                                                                                                                                           | 一次対応窓口, Infra担当C                                                                                                                                                                                      |

### 4.2. 定期作業

| 作業内容               | 頻度     | 実施時間帯   | 担当者     | 手順概要                                                                   | 備考                                                               |
| :--------------------- | :------- | :----------- | :--------- | :------------------------------------------------------------------------- | :----------------------------------------------------------------- |
| **DBバックアップ取得** | 毎日     | AM 3:00      | Infra担当C | `mysqldump` スクリプト実行 or クラウドDBスナップショット機能実行             | 失敗時は翌営業日に手動実行。結果をチケットに記録。                     |
| **ログローテーション** | -        | -            | Infra担当C | Logback設定 (`logback-spring.xml`) および OSのlogrotate等で自動実行 | 設定ファイルでローテーション設定（例: 日次、14世代保持）を確認。         |
| **古いログ削除/アーカイブ** | 週次     | 月曜日 AM    | Infra担当C | スクリプト等で保管期間（例: 14日）を超えたログファイルを削除またはアーカイブ | ディスク容量監視と連動。                                             |
| **サーバーリソースレポート確認** | 週次     | 月曜日 午前  | Infra担当C | Zabbix等のレポートを確認し、リソース使用量の傾向（増加、高止まり）を把握   | 異常傾向があればチケット起票し、関係者 (App担当含む) に共有。          |
| **DBバックアップ リストアテスト** | 半期に一度 | (別途計画) | Infra担当C | 別途用意した検証環境にて、バックアップからのリストア手順をテスト             | テスト結果を記録。手順書にフィードバック。                               |

### 4.3. アカウント管理

ユーザーアカウント（管理者含む）の追加、権限変更、削除依頼は、所定の申請フローに基づき、運用保守責任者の承認を得て実施する。(詳細手順は別途「アカウント管理手順書」に記載)

## 5. 保守業務

システムの修正、改善、問題解決のための業務。

### 5.1. 障害対応

1.  **インシデント受付**: 一次対応窓口 (開発チーム) が、ユーザーからの報告または監視アラートにより障害を検知し、Backlogに障害チケットを起票する。緊急度（高/中/低）を仮設定する。
2.  **一次切り分け**:
      - チケットに発生状況、エラー内容、影響範囲、発生時刻などを記録。
      - 関連ログ（アプリログ、サーバーログ、Kibanaなど）を確認。
      - 可能であれば再現テストを実施。
      - 原因箇所のあたりをつけ、担当チーム（アプリケーション/インフラ）を特定。
3.  **エスカレーション**: 特定した担当チームへBacklogチケットで引き継ぎ。必要に応じてSlackや電話で連絡。緊急度に応じて運用保守責任者へ報告。
4.  **原因調査・復旧**: 各担当チームは詳細調査を実施。
      - **アプリケーション障害**: コード調査、デバッグ、DBデータ確認など。
      - **インフラ障害**: サーバー/NW/DB設定確認、リソース状況確認など。
      - **暫定対応**: 必要に応じて、サービス影響を最小限にするための暫定措置（機能の一部停止、サーバー再起動など）を実施。実施前に責任者の承認を得る。
      - **恒久対応**: 根本原因を特定し、修正コードのデプロイ、設定変更、データ修正などを行う。修正リリースは本計画書およびリリース手順書に準ずる。
5.  **完了報告・クローズ**: 復旧確認後、チケットに対応内容、原因分析、実施した恒久対策、再発防止策を詳細に記録し、関係者に報告の上クローズする。関連ドキュメント（FAQ、障害対応手順書など）も更新する。
6.  **障害レベル定義**: (別途定義する基準に基づき対応)
      - **重大**: 広範囲のサービス停止、データ損失、セキュリティ侵害など → 最優先で対応、経営層へ報告。
      - **重要**: 主要機能の利用不可、多数のユーザーに影響 → 営業時間内は即時対応、時間外もオンコール対応。
      - **軽微**: 一部機能の不具合、特定ユーザーのみ影響 → 営業時間内に対応。

### 5.2. 問い合わせ対応

1.  一次対応窓口がユーザーからの問い合わせ（操作方法、仕様確認など）を受け付け、Backlogに問い合わせチケットを起票。
2.  一次対応窓口は、FAQや運用マニュアルを参照し回答。解決しない場合は担当チーム（主にアプリケーション担当）へエスカレーション。
3.  担当チームは調査・回答し、チケットに対応履歴を記録。
4.  頻度の高い問い合わせはFAQに追加する。

### 5.3. セキュリティ対応

1.  **脆弱性情報収集**: 担当者 (App/Infra) は、月に一度、JVN、使用しているOSS（Spring, Tomcat, MySQL等）、OSベンダーのセキュリティ情報を確認し、影響のある脆弱性がないか調査。結果をチケットに記録。
2.  **パッチ適用計画**: 担当者 (App/Infra) は、四半期に一度、OSおよび主要ミドルウェアの累積パッチやセキュリティアップデートの適用計画を立案し、運用保守責任者の承認を得る。テスト計画も併せて作成。
3.  **パッチ適用実施**: 承認された計画に基づき、まずテスト環境で適用・検証を行い、問題なければ本番環境へ適用。リリース手順書に準じて実施。
4.  **緊急パッチ対応**: 重大な脆弱性（特にゼロデイ攻撃の可能性があるもの）が発見された場合、直ちに運用保守責任者に報告。影響調査、暫定回避策の検討、緊急パッチ適用の要否と計画を迅速に決定し、実行する。

### 5.4. 追加開発・保守開発

1.  **要望受付・管理**: 機能追加、改善要望、仕様変更依頼などは、Backlogの要望チケットとして起票・管理する。
2.  **評価・優先順位付け**: 運用保守責任者、企画担当、開発チームで定期的に（例: 月に一度）要望チケットをレビューし、重要度、緊急度、開発工数などを評価して対応優先順位を決定する。
3.  **開発・テスト**: 決定された優先順位に基づき、アプリケーション担当が開発計画を立て、Gitフローに従って開発、テスト（単体、結合）を実施する。
4.  **リリース**: テスト完了後、リリース判定を経て、リリース手順書に基づき本番環境へリリースする。

### 5.5. パフォーマンス管理

1.  アプリケーション担当およびインフラ担当は、月に一度、監視ツール (Zabbix等) のレポートを確認し、主要APIの応答時間、サーバーリソース使用率の推移を分析する。
2.  SLOで定めた応答時間を超過する傾向が見られる場合や、ユーザーから性能に関する指摘があった場合は、原因調査（プロファイリング、スロークエリ調査など）を実施する。
3.  調査結果に基づき、アプリケーション改修（コード最適化、キャッシュ導入など）、DBチューニング（インデックス追加、クエリ改善）、インフラ増強（スケールアップ/アウト）などの対策を検討・実施する。

## 6. ロールバック手順

**6.1 ロールバック判断基準**

以下のいずれかの状況が発生し、ポストリリース確認担当者および作業担当者が15分以内での解決が困難と判断した場合、リリース責任者 (氏名A) がロールバックを決定する。

- アプリケーションが起動しない、または起動後すぐに停止する。
- 主要機能（商品表示、カート、注文、管理）が全く動作しない、エラーが頻発する、または性能が極端に劣化する。
- データの不整合や破損が発生している。
- システムのパフォーマンスが著しく劣化し、サービス提供に支障をきたす。
- 予期せぬ重大なセキュリティ上の問題が発見された。

**6.2 ロールバック作業手順**

| No | 手順                                                         | 担当者     | 確認者     | チェック | 備考/コマンド例 (環境に合わせて要変更)                                                                                                                                  |
| :-: | :----------------------------------------------------------- | :--------- | :--------- | :------: | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 1  | **ロールバック開始宣言** | 責任者A    | 全員       |    [ ]   |                                                                                                                                                                         |
| 2  | **サービス停止 (再確認)** | Infra担当C | 責任者A    |    [ ]   | サービスが再開されていた場合、再度停止する (手順5.1, 5.2参照)。                                                                                                          |
| 3  | **新バージョン アプリケーション停止** | App担当B   | 確認担当D  |    [ ]   | 手順5.3 参照。                                                                                                                                                          |
| 4  | **新バージョンJARファイル退避** | App担当B   | 確認担当D  |    [ ]   | `mv /path/to/app/raffinehome-1.0.0.jar /path/to/rollback_artifacts/` <br> `rm /path/to/app/raffinehome-current.jar` (シンボリックリンクの場合)                          |
| 5  | **旧バージョンJARファイル復元** | App担当B   | 確認担当D  |    [ ]   | 手順5.4でバックアップした旧バージョンJARを戻す。<br> `cp /path/to/app_backup/raffinehome-vX.Y.Z_YYYYMMDDHHMM.jar /path/to/app/raffinehome-vX.Y.Z.jar` <br> `ln -sfn raffinehome-vX.Y.Z.jar /path/to/app/raffinehome-current.jar` |
| 6  | **【条件分岐】DBスキーマ変更を行ったか？** | 責任者A    | 全員       |    [ ]   | 今回(v1.0.0)は通常 No。Yesの場合は手順7へ。Noの場合は手順8へ。                                                                                                        |
| 7  | **データベースリストア (またはロールバックSQL実行)** | Infra担当C | App担当B   |    [ ]   | 事前取得したバックアップからリストア or ロールバック用SQLを実行。リストア手順はDB運用手順書参照。                                                                           |
| 8  | **旧バージョン アプリケーション起動** | App担当B   | 確認担当D  |    [ ]   | 手順5.8, 5.9, 5.10 参照。起動するJARは旧バージョン。                                                                                                                 |
| 9  | **旧バージョン 動作確認** | 確認担当D  | App担当B   |    [ ]   | 手順5.11, 5.12, 5.13 の主要項目を実施し、リリース前の状態に戻っていることを確認。                                                                                         |
| 10 | **サービス再開 (告知)** | Infra担当C | 責任者A    |    [ ]   | 手順5.15, 5.16 参照。ロールバックが完了し、旧バージョンでサービス再開した旨を告知。                                                                                       |
| 11 | **ロールバック完了報告** | 責任者A    | 全員       |    [ ]   | 関係者にロールバックが完了したことを報告。上記までを3時間以内を目安に実行する。                                                                                                                              |

## 7. 作業完了後の対応

- **監視再開**: [ ] (担当: Infra担当C) 一時停止していた監視アラートを有効に戻す。
- **リリース結果報告**: [ ] (担当: 責任者A) リリース作業の結果（成功/ロールバック）、所要時間、発生した問題点などをまとめ、関係者に報告する。
- **振り返り**: [ ] (担当: 全員参加) リリース作業に関する振り返りミーティングを実施し、今回の反省点や改善点を次回リリースに活かす。
