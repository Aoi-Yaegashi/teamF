# 機能: 商品表示機能

## テスト対象API:

- `GET /api/products` (商品一覧取得)
- `GET /api/products/{id}` (商品詳細取得)

## テストデータ準備方針:

- テストの独立性を保つため、各テストケース実行前にデータベースをクリーンな状態にし、テストケースごとに必要な商品データを投入することを想定します。
- 以下では、テストデータとして投入される商品情報を `Product(id, name, price, salePrice, description, stockQuantity, imageUrl, isStock, is_Deleted` の形式で記述します。

## テストシナリオ

### No. 1-1

- テストケース名: 商品一覧表示（正常系 - 商品データが複数存在する場合）
- 前提条件:
  - データベースの `products` テーブルに以下の2件の商品データが存在する。
    - `Product(1, "シンプルデスクオーガナイザー", 3500, 3150, "説明A", 10, "/images/desk-organizer.png", true, false)`
    - `Product(2, "アロマディフューザー（ウッド）", 4200, 3780, "説明B", 5, "/images/aroma-diffuser.png", true, false)`
- 手順:
  1. HTTP GETリクエストを `/api/products` エンドポイントに送信する。
- 入力データ: なし (GETリクエストのためボディなし)
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること。
  2. レスポンスボディがJSON形式であること。
  3. 返却されるJSON配列が2つの要素を持っていること。
  4. 各要素が `ProductListDTO` DTOの形式（`id`, `name`, `price`, `salePrice`, `description`,`stockQuantity`, `imageUrl`, `inStock` フィールドを持つ）であること。
  5. 11番目の要素の内容が `{"id": 1, "name": "シンプルデスクオーガナイザー", "price": 3500, "salePrice": 3150, "description":"説明A" , "stockQuantity": 10, imageUrl": "/images/desk-organizer.png", true}` であること（順序不同でも可）。
  6. 2番目の要素の内容が `{"id": 2, "name": "アロマディフューザー（ウッド）", "price": 4200, "salePrice": 3780, "description":"説明B", "stockQuantity": 5, imageUrl": "/images/aroma-diffuser.png", true}` であること（順序不同でも可）。

### No. 1-2

- テストケース名: 商品詳細表示（正常系 - 存在する商品IDを指定）
- 前提条件:
  - データベースの `products` テーブルに以下の商品データが存在する。
    - `Product(1, "シンプルデスクオーガナイザー", 3500, 3150, "詳細な説明A", 10, "/images/desk-organizer.png", true)`
- 手順:
  1. HTTP GETリクエストを `/api/products/1` エンドポイントに送信する。
- 入力データ:
  - パスパラメータ: `id = 1`
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること。
  2. レスポンスボディがJSON形式であること。
  3. 返却されるJSONオブジェクトが `Product`DTO の形式（`id`, `name`, `price`, `salePrice`, `description`, `stockQuantity`, `imageUrl`, `isStock` フィールドを持つ）であること。
  4. JSONオブジェクトの内容が `{"id": 1, "name": "シンプルデスクオーガナイザー", "price": 3500,　"salePrice": 3150, "description": "詳細な説明A", "stockQuantity": 10, "imageUrl": "/images/desk-organizer.png", "inStock": true}` であること。

### No. 1-3

- テストケース名: 商品詳細表示（異常系 - 存在しない商品IDを指定）
- 前提条件:
  - データベースの `products` テーブルに `id = 99` のデータが存在しない。
- 手順:
  1. HTTP GETリクエストを `/api/products/99` エンドポイントに送信する。
- 入力データ:
  - パスパラメータ: `id = 99`
- 期待結果:
  1. HTTPステータスコードが `404 Not Found` であること。
  2. レスポンスボディが空であること（またはエラーを示すJSON）。

### No. 1-4

- テストケース名: 商品詳細表示（異常系 - 不正な形式の商品IDを指定）
- 前提条件:
  - 特になし（DBの状態によらない）。
- 手順:
  1. HTTP GETリクエストを `/api/products/abc` エンドポイントに送信する。
- 入力データ:
  - パスパラメータ: `id = "abc"` (数値ではない)
- 期待結果:
  1. HTTPステータスコードが `400 Bad Request` または `500 Internal Server Error` であること（Spring Bootのデフォルトや `GlobalExceptionHandler` の実装に依存。今回は `GlobalExceptionHandler` が `RuntimeException` を500で処理するため、500になる可能性が高い）。
  2. レスポンスボディにエラー情報（例: 型変換エラーを示すメッセージ）が含まれること。
  3. `ProductController` の `getProductById` メソッド自体が呼び出される前に、Spring MVCのディスパッチャーサーブレットまたはパラメータバインディングの段階でエラーが発生する。
  4. `ProductService` や `ProductRepository` のメソッドは呼び出されないこと。

### No. 1-5

- テストケース名: 商品一覧表示（正常系 - 商品データが0件の場合）
- 前提条件:
  - データベースの `products` テーブルが空。
- 手順:
  1. HTTP GETリクエストを `/api/products` エンドポイントに送信する。
- 入力データ: なし
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること。
  2. レスポンスボディがJSON形式の空の配列 `[]` であること。

### No. 1-6

- テストケース名: 商品詳細表示（正常系 - descriptionやimageUrlがnullの商品）
- 前提条件:
  - データベースの `products` テーブルに以下の商品データが存在する。
    - `Product(3, "商品C", 3000, 2700, null, 8, null, true)`
- 手順:
  1. HTTP GETリクエストを `/api/products/3` エンドポイントに送信する。
- 入力データ:
  - パスパラメータ: `id = 3`
- 期待結果:
  1. HTTPステータスコードが `200 OK` であること。
  2. レスポンスボディがJSON形式であること。
  3. 返却されるJSONオブジェクトが `Product` DTOの形式であること。
  4. JSONオブジェクトの内容が `{"id": 3, "name": "コットンブランケット", "price": 5800,  "salePrice": 5220, "description": null, "stockQuantity": 8, "imageUrl": null, true` であること（`description` と `imageUrl` が `null` であることを確認）。

### No. 1-7

- テストケース名: 論理削除された商品の詳細表示（異常系）
- 前提条件:
  - データベースの `products` テーブルに以下の商品データが存在する。8番目の項目が論理削除を表すフラグである。（trueなら論理削除されている。）
    - `Product(3, "コットンブランケット", 5800, 5220, "説明C", 10, "/images/cotton-blanket.png", true, false)`
- 手順:
  1. HTTP GETリクエストを `/api/products/3` エンドポイントに送信する。
- 入力データ:
  - パスパラメータ: `id = 3`
- 期待結果:
  1. HTTPステータスコードが `404 Not Found`
  2. レスポンスボディが空であること（またはエラーを示すJSON）。