
### No. 3-5

- テストケース名: 注文（正常系 - 代引き決済を選択し、決済連携が正常に行われる）

- 前提条件:

  - DBに商品 `Product(id=2, productName="商品B", unitPrice=2000, quantity=8)` が存在する。
  - セッションにカート `Cart(items={"2": CartItem(..., quantity=1, subtotal=2000)}, itemCount=1, totalPrice=2000)` が存在する。
  - `PaymentService` はMock化されており、代引き決済API連携が成功するよう設定されている（例: レスポンスコード200）。
  - 注文時の決済方法として `"CASH_ON_DELIVERY"` がリクエストに含まれている。

- 手順:

  1. HTTP POSTリクエストを `/api/orders` エンドポイントに送信する。リクエストボディに顧客情報と決済方法を含める。

- 入力データ:

  - リクエストボディ（JSON）:

    ```json
    {
      "customerInfo": {
        "cusomerName": "佐藤 次郎",
        "cusomerEmail": "jiro@example.com",
        "shippingAddress": "大阪府大阪市テスト2-2",
        "phoneNumber": "06-1234-5678"
      },
      "paymentMethod": "CASH_ON_DELIVERY"
    }
    ```

  - セッション: 上記前提条件のカート情報

- 期待結果:

  1. HTTPステータスコードが `201 Created` であること。
  2. レスポンスボディがJSON形式であり、`Id` と `orderDate` を含むこと。`Id` はnullでない整数値、`orderDate` は有効な日時文字列であること。
  3. DB状態変化:

     - `orders` テーブルに1件レコードが追加され、顧客情報、合計金額(2000)、支払方法(`"CASH_ON_DELIVERY"`)、ステータス("PENDING")が正しく登録されていること。
     - `order_details` テーブルに1件レコードが追加され、商品B、単価2000、数量1が正しく登録されていること。
     - `products` テーブルの商品ID=2の在庫数が `7` (8 - 1) に更新されていること。
  4. セッション状態変化: セッションから `cart` 属性が削除されていること（カートがクリアされている）。
  5. `OrderService.placeOrder` が1回呼び出されること。
  6. `ProductRepository.findById(2)` が呼び出されること。
  7. `OrderRepository.save` が1回呼び出されること。
  8. `ProductRepository.decreaseStock(2, 1)` が1回呼び出されること。
  9. `PaymentService.processCashOnDelivery(order)` が1回呼び出され、成功レスポンスが返ってくること。
  10. `CartService.clearCart` が1回呼び出されること。
  11. ログに「代引き決済処理が正常に完了しました」などのINFOレベルメッセージが記録されていること。
