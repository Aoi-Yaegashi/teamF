### No. 3-12

- テストケース名: 注文（異常系 - 注文完了メール送信時にメール送信処理が失敗する）

- 前提条件:

  - DBに商品 `Product(id=3, productName="商品C", unitPrice=300, quantity=4)` が存在する。
  - セッションにカート `Cart(items={"3": CartItem(..., quantity=2, subtotal=600)}, itemCount=2, totalPrice=600)` が存在する。
  - `MailService` はMock化されており、メール送信処理が失敗するように設定されている（例: 例外をスロー）。

- 手順:

  1. HTTP POSTリクエストを `/api/orders` エンドポイントに送信する。リクエストボディに顧客情報を含める。

- 入力データ:

  - リクエストボディ（JSON）:

    ```json
    {
      "customerInfo": {
        "customerName": "鈴木 三郎",
        "cusomerEmail": "saburo@example.com",
        "shippingAddress": "愛知県名古屋市テスト3-3",
        "phoneNumber": "052-123-4567"
      }
    }
    ```

  - セッション: 上記前提条件のカート情報

- 期待結果:

  1. HTTPステータスコードが `201 Created` であること。
  2. レスポンスボディがJSON形式であり、`Id` と `orderDate` を含むこと。`Id` はnullでない整数値、`orderDate` は有効な日時文字列であること。
  3. DB状態変化:

     - `orders` テーブルに1件レコードが追加され、顧客情報、合計金額(600)、注文日時、ステータス("PENDING")が正しく登録されていること。
     - `order_details` テーブルに1件レコードが追加され、商品C、単価300、数量2が正しく登録されていること。
     - `products` テーブルの商品ID=3の在庫数が `2` (4 - 2) に更新されていること。
  4. セッション状態変化: セッションから `cart` 属性が削除されている（カートがクリアされている）こと。
  5. `OrderService.placeOrder` が1回呼び出されること。
  6. `MailService.sendOrderConfirmationMail` が1回呼び出され、失敗（例外スロー）すること。
  7. ログに「注文確認メール送信に失敗しました」などのERRORレベルメッセージが出力されていること。
  8. 全体の注文処理は成功しており、メール送信失敗はレスポンスに影響しないこと。

