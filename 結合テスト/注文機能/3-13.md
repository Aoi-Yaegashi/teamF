### No. 3-13

- テストケース名: 注文（異常系 - 代引き決済連携APIでエラーが発生し、注文処理がロールバックされる）

- 前提条件:

  - DBに商品 `Product(id=4, productName="商品D", unitPrice=1000, quantity -5)` が存在する。
  - セッションにカート `Cart(items={"4": CartItem(..., quantity=1, subtotal=1000)}, itemCount=1, totalPrice=1000)` が存在する。
  - 代引き決済連携APIを呼び出す `PaymentService` はMock化されており、決済処理が失敗（例: APIエラー応答）するよう設定されている。

- 手順:

  1. HTTP POSTリクエストを `/api/orders` エンドポイントに送信する。リクエストボディに顧客情報と支払い方法「代引き」を含める。

- 入力データ:

  - リクエストボディ（JSON）:

    ```json
    {
      "customerInfo": {
        "cusomerName": "田中 四郎",
        "cusomerEmail": "shiro@example.com",
        "shippingAddress": "大阪府大阪市中央区4-4-4",
        "phoneNumber": "06-5555-4444"
      },
      "paymentMethod": "COD"
    }
    ```

  - セッション: 上記前提条件のカート情報

- 期待結果:

  1. HTTPステータスコードが `500 Internal Server Error` であること。
  2. レスポンスボディにエラーメッセージが含まれていること（例：「決済処理に失敗しました」）。
  3. DB状態変化:

     * 注文は登録されていない（ロールバックされている）こと。
     * 在庫数も変わっていないこと（商品ID=4 の在庫は5のまま）。
  4. セッション状態変化: カートは変更されていない（クリアされていない）こと。
  5. `OrderService.placeOrder` が1回呼び出されること。
  6. `PaymentService.processCODPayment` が1回呼び出され、エラー応答を返すこと。
  7. ログに「代引き決済処理でエラーが発生しました」などのERRORレベルメッセージが記録されていること。

