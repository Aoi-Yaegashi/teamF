# 7. 運用・保守設計の概要 

## 7.1 ログ設定方針 

### 7.1.1 基本方針 

 - システム運用・障害対応・セキュリティ監査・法令対応のため、全主要イベントのログを適切に取得・管理する。 

 - ログは一貫したフォーマットで記録し、改ざん防止・アクセス制御・暗号化などのセキュリティ対策を徹底する。 

### 7.1.2 ログ取得対象 

 - アクセスログ：ユーザーのアクセス元IP、日時、リクエスト内容、レスポンスコード等 

 - 認証ログ：ログイン/ログアウト、認証失敗、アカウントロック等 

 - 操作ログ：商品登録・編集・削除、注文管理、CSV出力等の管理操作 

 - エラーログ：システムエラー、例外発生時の詳細情報 

 - システムイベントログ：サーバ起動/停止、バックアップ処理、障害通知等 

### 7.1.3 ログ記録内容（必須項目） 

 - タイムスタンプ（ミリ秒単位推奨） 

 - 重要度レベル（例：DEBUG, INFO, WARNING, ERROR, CRITICAL） 

 - イベント種別（例：ログイン、商品登録、注文確定、エラー発生） 

 - ユーザーID/管理者ID/セッションID 

 - 関連リソースID（商品ID、注文ID等） 

 - 詳細説明（操作内容やエラー内容） 

 - ソースIPアドレス（特に管理画面や外部アクセス時） 

 - システムコンポーネント名（該当機能やモジュール名） 

### 7.1.4 ログレベル・出力制御 

 - DEBUG：開発・検証環境のみ出力 

 - INFO：正常な操作・イベント 

 - WARNING：想定外だが致命的でない事象 

 - ERROR：処理失敗や障害発生 

 - CRITICAL：システム全体に影響する重大障害 

 - 本番環境ではINFO以上を標準出力、必要に応じてWARNING/ERROR/CRITICALを重点的に監視する。 

### 7.1.5 ログ保管・管理 

 - 保管期間：アクセスログは1年間、取引データログは7年間を目安に保管。法令・業界基準に応じ適宜見直しを実施する。 

 - 保管方法：改ざん防止のため、アクセス制御・暗号化・タイムスタンプ付与。必要に応じてライトワンス媒体やクラウドストレージを利用する。 

 - バックアップ：定期的にバックアップを取得し、別媒体・地理的に分散した場所に保存する。 

 - 廃棄手順：保管期間経過後は、安全な方法で完全消去を実施する。 

### 7.1.6 ログ監視・分析・通知 

 - 定期レビュー：アクセスログ・操作ログは最低月1回、PCI DSS等の要件がある場合は日次レビューを実施する。 

 - 異常検知：不正アクセスや異常操作を自動検知し、管理者へ即時通知（例：メール・アラート）する。 

 - 監査対応：必要に応じてログの検索・集計・レポート出力ができる仕組みを用意する。 

### 1.7 セキュリティ・プライバシー配慮 

 - 個人情報・パスワード・クレジットカード情報はログに記録しない。 

 - ログファイルへのアクセス権限は最小限の管理者に限定する。 

 - ログの暗号化、改ざん検知（ハッシュ値付与等）を実施する。 

### 1.8 運用・改善 

 - ログ運用ルール・監査手順は運用マニュアルに明記し、定期的に見直し・改善を実施する。 

 - 法令・ガイドライン（例：IPA/経産省ガイドライン、PCI DSS等）の改正に応じて方針をアップデートする。 

 

## 7.2 監視設定方針 

### 7.2.1 監視の目的 

 システムの安定稼働と障害の早期発見・対応を実現するため、主要なサービス・インフラ・外部連携・バックアップ・ログを常時監視する。 

### 7.2.2 監視対象・項目 

 - サイト稼働：サイトURLの応答可否について、1.5秒超で応答不可とする。 

 - サーバ資源：CPU/メモリ/ディスク使用率、主要プロセス稼働について80%以上で警告する。 

 - バックアップ：バックアップ処理の成否について、処理失敗時はアラート通知を実施する。 

外部連携：外部API・サービスの応答可否について、エラー発生時はアラート通知を実施する。 

ログ監視：エラー・警告・不正アクセスを記録する。 

### 7.2.3 通知・アラート設定 

 - 重大障害、バックアップ失敗、不正アクセス等の異常時は5分以内に管理者へ自動メールで通知する。 

 - 通知内容には発生時刻、障害内容、影響範囲、初動対応手順を含める。 

### 7.2.4 運用・管理 

 - 監視は24時間365日実施する。 

 - 障害発生時の対応フロー・連絡先は運用マニュアルに明記する。 

 - 監視項目・しきい値・通知先は定期的に見直し・更新する。 

### 7.2.5 セキュリティ・ガイドライン対応 

 監視設定・運用は経産省/IPA等のガイドラインに準拠し、ミドルウェア・監視ツールは常に最新状態を維持する。 

## 7.3. バックアップ・リカバリ方針 

### 7.3.1 バックアップの目的 

万が一の障害や誤操作、サイバー攻撃等によるデータ消失時でも、業務継続・サービス早期復旧を実現するため、重要データの定期的なバックアップと迅速なリカバリ体制を構築する。 

### 7.3.2 バックアップ対象 

 - データベース（注文・顧客・商品情報等） 

 - アプリケーション構成ファイル・設定ファイル 

 - アップロード画像・添付ファイル 

### 7.3.3 バックアップ方式・頻度 

 - 方式：フルバックアップを基本とし、必要に応じて差分・増分バックアップを組み合わせる。 

 - 頻度：毎日1回、深夜帯に自動実行（業務影響の少ない時間帯を選定）する。 

 - 保存世代：30日分を保持し、古いバックアップは自動削除する。 

### 7.3.4 バックアップデータの保管 

 - バックアップデータは暗号化して保存する。 

 - クラウドストレージや異なる物理ロケーションにもコピーし、災害・障害時のリスク分散を図る。 

 - アクセス権限は最小限に限定する。 

### 7.3.5 リカバリ（復元）方針 

 - 障害発生時は直近の正常なバックアップから復元し、2時間以内のサービス再開（MTTR）を目標とする。 

 - テスト環境で定期的にリカバリ手順の検証を実施し、実際に復元できることを確認する。 

 - リカバリ手順は運用マニュアルに明記し、担当者が即時対応できる体制を整備する。 

### 7.3.6 運用管理 

 - バックアップ・リカバリの実施状況は自動記録・監視し、失敗時は管理者へ即時通知する。 

 - バックアップ・リカバリ手順、保存期間、世代管理、削除ポリシーは定期的に見直し・改善する。 