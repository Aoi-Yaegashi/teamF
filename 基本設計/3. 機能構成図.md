## 3. 機能設計

### 3.1 機能一覧
#### 3.1.1 商品閲覧・購入機能（購入者向け）

- 商品一覧・カテゴリ別の商品閲覧機能
- 商品詳細ページの表示（写真、価格、説明、素材等）
- 商品をカートに追加／削除／数量変更する機能
- 現在カートに入っている商品の一覧、数量、小計、合計金額を表示し、数量変更や削除を可能にする
- 注文確定処理（カート内容の購入確定。なお、"在庫数=<0"の場合、注文を受け付けない）
- 注文完了後に確認メールを自動送信

#### 3.1.2 商品検索機能 
- 単語検索（検索対象は「商品名」とする）

#### 3.1.3 配送料金設定・計算機能

- 送料設定機能（管理者：購入金額、地域によって配送料を設定できる。初期値としては、全国一律500円とする。）
- 配送方法の表示・選択機能

#### 3.1.4 商品管理機能（管理者向け）

- 商品登録・編集機能（商品名・価格・説明・画像など）
- 商品削除機能
- 商品の在庫数管理（在庫数の更新）
- 商品のカテゴリ設定・変更
- セール価格設定機能（期間限定価格）
- 商品情報の一括登録・編集（CSVインポート）
- 商品情報の一括取得（CSVエクスポート）

#### 3.1.5 注文管理機能（管理者向け）

- 注文一覧表示
- 注文内容詳細の確認
- 発送ステータスの更新（出荷済など）
- 注文データのCSVエクスポート機能

#### 3.1.6 サイト運営機能（管理者向け）

- 管理画面ログイン機能（ID・パスワード認証）
- サイト基本情報登録・編集（会社概要、特商法表記、プライバシーポリシーなど）
- お問い合わせ受付フォーム（購入者からの問い合わせ受付）

### 3.2 機能構成図

```mermaid

flowchart LR
  subgraph Front["購入者向け機能"]
    A[商品一覧・詳細閲覧機能]
    A1[商品検索機能]
    B[カート管理機能]
    C[購入手続き機能]
    D[注文金額計算機能]
    E[注文確定処理機能]
    F[注文データ登録機能]
    G[注文完了メール自動送信機能]
    H[問い合わせ送信機能]
  end

  subgraph Admin["管理者向け機能"]
    L[管理者認証機能]
    I[商品管理機能]
    I1[商品登録機能]
    I2[商品編集機能]
    I21[カテゴリ設定・変更機能]
    I22[セール価格設定機能]
    I23[在庫数更新機能]
    I3[商品削除機能]
    J[注文管理機能]
    M[配送料設定機能]
    N[問い合わせ管理機能]
    O[注文メール自動送信機能]
  end


  %% 購入フロー
  A --> B --> C --> D --> E --> F --> G
  A --> A1 --> B

  %% 問い合わせフロー
  A ---> H

  %% 管理者画面起点
  L --> I
  L --> J
  L --> M
  L --> N

  I --> I1 & I2 & I3
  I2 --> I21 & I22 & I23
  F -.->|注文数を在庫数から減らす| I23
  F --> O

  %% 配送→支払選択の依存
  M -.->|設定した配送料金を注文金額に反映| D
  

  %% 問い合わせ→管理への遷移
  H -.-> N

```

### 3.3 主要機能フロー

#### 商品注文フロー

```mermaid

sequenceDiagram
  participant A as ユーザー
  participant B as ECサイト
  participant C as DBシステム
  participant D as メールサーバ

  A ->> B: 購入手続きに進む
  B ->> A: 配送先・支払方法入力フォームを表示
  A ->> B: 情報を入力して注文確認へ
  B ->> A: 注文内容の確認画面を表示
  A ->> B: 注文を確定
  B ->> C: 注文情報を登録
  C -->> B: 登録完了（注文ID返却）
  B ->> A: 注文完了画面を表示
  B ->> D: 注文確認メールを送信
  D -->> A: 注文完了メールを受信

```


#### セール情報設定フロー

```mermaid

sequenceDiagram
  participant A as 管理者
  participant B as ECサイト（管理画面）
  participant C as DBシステム
  participant D as ECサイト（ユーザー画面）

  A ->> B: 管理画面にログイン
  A ->> B: 商品一覧から編集対象商品を選択
  B ->> C: 商品情報を取得
  C -->> B: 商品情報を返却

  A ->> B: セール価格・期間を入力して保存
  B ->> C: セール情報を更新（価格・期間を登録）
  C -->> B: 更新完了（成功ステータス）

  B -->> A: セール価格が設定された旨を通知

  D ->> C: 商品一覧データを取得
  C -->> D: セール価格を反映した商品データを返却

```
