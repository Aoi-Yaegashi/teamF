# ECサイト データフロー概要

---

## 1. 商品一覧表示処理のデータフロー

1. **画面(F02 商品一覧ページ)**: ユーザーがカテゴリや検索条件を指定して商品一覧を表示要求。  
2. **アプリケーション(Backend)**: 画面からの条件を受け取り、`PRODUCT`テーブルおよび`CATEGORY`テーブルから該当商品の一覧を取得。  
3. **データベース(DB)**: `PRODUCT`テーブルと`CATEGORY`テーブルから商品データを取得。  
4. **アプリケーション(Backend)**: 取得結果を整形し画面表示用に加工。  
5. **画面(F02 商品一覧ページ)**: 商品一覧を表示。

---

## 2. 商品詳細表示処理のデータフロー

1. **画面(F03 商品詳細ページ)**: ユーザーが商品を選択し、詳細表示要求を送信。  
2. **アプリケーション(Backend)**: 商品IDを受け取り、`PRODUCT`テーブルから該当商品の詳細情報を取得。  
3. **データベース(DB)**: `PRODUCT`テーブルから商品詳細情報を取得。  
4. **アプリケーション(Backend)**: 詳細情報を整形し画面表示用に加工。  
5. **画面(F03 商品詳細ページ)**: 商品詳細を表示。

---

## 3. カート操作処理のデータフロー

1. **画面(F04 カートページ)**: ユーザーが商品をカートに追加・削除・数量変更を実施。  
2. **アプリケーション(Backend)**: 操作内容とセッショントークンを受け取り、該当カート情報の作成・更新・削除を行う。  
3. **データベース(DB)**: `CART`テーブルおよび`CART_ITEM`テーブルの該当レコードを更新。  
4. **アプリケーション(Backend)**: 更新後のカート内容を取得し、画面表示用に加工。  
5. **画面(F04 カートページ)**: 更新後のカート内容を表示。

---

## 4. 注文処理のデータフロー

1. **画面(F05 購入手続きページ（ゲスト）)**: ユーザーが配送先情報、連絡先などを入力し、注文確定を実行。  
2. **アプリケーション(Backend)**: 入力情報とカート内容を受け取り、新規注文レコードを`ORDER`テーブルに作成。  
3. **アプリケーション(Backend)**: 注文商品ごとに`ORDER_ITEM`テーブルに登録。配送情報を`SHIPPING_INFO`テーブルに登録。  
4. **データベース(DB)**: `ORDER`、`ORDER_ITEM`、`SHIPPING_INFO`テーブルにレコードを挿入・更新。  
5. **アプリケーション(Backend)**: 注文完了メールを生成し送信。  
6. **画面(F06 購入完了ページ)**: 注文完了メッセージを表示。

---

## 5. 注文ステータス履歴管理のデータフロー

1. **アプリケーション(Backend)**: 注文のステータス変更時に`ORDER_STATUS_HISTORY`テーブルに変更履歴を登録。  
2. **データベース(DB)**: ステータス変更履歴が保存される。  
3. **管理画面**: 管理者は注文のステータス履歴を閲覧可能。

---

## 6. 静的ページ管理と表示のデータフロー

1. **管理画面**: 管理者が`PAGE_CONTENT`テーブルにタイトル・本文を登録・編集。  
2. **データベース(DB)**: `PAGE_CONTENT`テーブルが更新される。  
3. **画面(F08 利用規約・特商法ページ、F09 プライバシーポリシーページ等)**: 表示要求があると対応する静的ページ内容をDBから取得し、画面に表示。

---

## 7. 管理者ログイン処理のデータフロー

1. **画面(管理者ログイン画面)**: 管理者がユーザー名とパスワードを入力しログインを実行。  
2. **アプリケーション(Backend)**: 入力情報を受け取り、`ADMIN_USER`テーブルのユーザー情報と照合し認証を実施。  
3. **データベース(DB)**: `ADMIN_USER`テーブルのユーザー名とパスワードハッシュを照合。  
4. **アプリケーション(Backend)**: 認証結果に応じてログイントークン発行またはエラーメッセージ返却。  
5. **画面(管理者ログイン画面)**: 認証成功時は管理画面へ遷移、失敗時はエラーメッセージ表示。

---

## 8. カートのセッション管理処理のデータフロー

1. **画面(全ページ)**: ユーザーがECサイトを訪問するとセッショントークンを発行（Cookieに保存）。  
2. **アプリケーション(Backend)**: セッショントークンを元に`CART`テーブルの該当カートを取得または新規作成。  
3. **データベース(DB)**: カート情報がセッション単位で管理される。  
4. **画面(各商品ページ・カートページ)**: カート情報に応じた商品情報を表示。

---

# ※備考  
- 上記データフローは初期リリースの基本的なECサイト機能に対応しています。  
- 将来的に会員機能や決済機能が追加される場合は、それらのデータフローも別途作成が必要です。  
- 各データフローは画面（UI）、アプリケーション処理、データベース操作の順で表現しています。

