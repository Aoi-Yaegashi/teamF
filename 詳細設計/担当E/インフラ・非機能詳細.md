## 8. 非機能要件詳細

### 8.1 性能

#### 8.1.1 商品一覧・詳細ページの表示速度
- **要件（再掲）**  
  商品一覧・詳細ページの表示速度は1.5秒以内（4G相当の回線速度）とする。

- **実現方法**  
  - HTML/CSS/JavaScript/画像の合計サイズを最適化し通信遅延を考慮した設計。  
  - 画像は1枚あたり300KB以下に自動圧縮し、WebP形式を優先利用。  
  - 画像はアップロード時にサーバーサイドで自動圧縮・リサイズ処理を行う。

#### 8.1.2 カート操作・ボタン等の応答時間
- **要件（再掲）**  
  カート操作やボタン押下時の応答時間は1秒以内とする。

- **実現方法**  
  - 非同期通信（Ajax等）を活用し、画面の部分更新により高速レスポンスを実現。  
  - サーバーAPIのレスポンスタイム最適化。  
  - 遅延時はローディングインジケーター表示でUX低下を防止。

#### 8.1.3 同時アクセス体制
- **要件（再掲）** 
  50ユーザーの同時アクセス時でも主要機能が遅延しない構成。

- **実現方法**  
  - サーバースペックを十分確保し、必要に応じオートスケール対応。  
  - CDN・DBキャッシュ等の活用で負荷軽減。  
  - 負荷テスト実施とボトルネックの継続的改善。

---

### 8.2 セキュリティ

#### 8.2.1 通信の暗号化（SSL/TLS）
- **要件（再掲）**  
  全通信でTLS1.2以上を使用。

- **実現方法 
  - HTTPS化およびHTTP→HTTPSリダイレクト設定。  
  - 証明書は信頼済みCAから取得管理。  
  - TLS1.0/1.1やSSLは無効化。

#### 8.2.2 管理画面ログイン認証
- **要件（再掲）**  
  ID＋パスワード認証、パスワードは8文字以上で記号含む複雑性必須。

- **実現方法**  
  - バリデーションで複雑性を保証。  
  - パスワードはbcryptでハッシュ化保存。  
  - パスワードリセットはメール認証で本人確認。

#### 8.2.3 脆弱性対策
- **要件（再掲）**  
  XSS、SQLインジェクション等を防止。

- **実現方法**  
  - 入力値サニタイズ・エスケープを徹底。  
  - DBアクセスはプリペアドステートメント必須。  
  - 出力時はHTMLエスケープ。  
  - CSRFトークンによるリクエスト検証。

#### 8.2.4 データ出力の安全性
- **要件（再掲）**  
  顧客・注文データはパスワード付きCSV形式で出力可能。

- **実現方法**  
  - CSVはパスワード付きZIPで出力。  
  - パスワードは管理者指定または自動生成し別途通知。  
  - ダウンロードは管理者のみ許可。

#### 8.2.5 バックアップとデータ損失対策
- **要件（再掲）** 
  誤操作などに備え定期バックアップ実施。

- **実現方法**  
  - DBの定期自動バックアップ設定。  
  - バックアップデータは暗号化し外部・クラウド保管。  
  - 復元手順マニュアル化と定期テスト実施。  
  - 重要操作は確認ダイアログや二重認証を導入。

---

### 8.3 可用性

#### 8.3.1 月間稼働率
- **要件（再掲）**  
  月間稼働率99.5%以上（メンテ除く）。

- **実現方法**  
  - 冗長化、フェイルオーバー構成を検討。  
  - メンテナンス時間を事前告知。

#### 8.3.2 データバックアップ
- **要件（再掲）**  
  毎日1回バックアップ、30日保存。

- **実現方法**  
  - 夜間自動バックアップ。  
  - 暗号化し安全ストレージ保管。  
  - 失敗時は管理者通知。

#### 8.3.3 障害発生時の自動通知
- **要件（再掲）** 
  5分以内に障害通知。

- **実現方法**  
  - Zabbix等で監視、障害検知即アラート送信。  
  - 通知内容に発生時刻・障害内容等を含む。

#### 8.3.4 復旧目標時間（MTTR）
- **要件（再掲）**  
  障害から2時間以内に復旧。

- **実現方法**  
  - 監視ツールによる即時検知と標準復旧フロー。  
  - 復旧手順の定期見直しと訓練。

#### 8.3.5 障害対応フロー
- **要件（再掲）** 
  障害対応手順をマニュアル化。

- **実現方法**  
  - 初動対応～事後報告まで詳細手順作成。  
  - 定期的に最新情報へ更新。

---

### 8.4 その他

#### 8.4.1 保守・運用性

##### 8.4.1.1 商品登録作業の効率化
- **要件（再掲）**  
  1件登録3分以内。

- **実現方法**  
  - 必須項目だけ初期表示。  
  - 画像ドラッグ＆ドロップ、複数同時選択対応。  
  - 入力補助・バリデーション実装。  
  - ステップ最小化、プレビュー機能。

##### 8.4.1.2 情報アクセスの迅速化
- **要件（再掲）**
  商品・注文は3クリック以内でアクセス可能。

- **実現方法**  
  - ダッシュボード・メニューにショートカット配置。  
  - 検索・フィルタ強化。  
  - パンくずリスト・戻るボタン設置。

##### 8.4.1.3 管理者向けマニュアルの提供
- **要件（再掲）** 
  PDF10ページ以内の操作マニュアル納品。

- **実現方法**  
  - 主要機能の操作手順網羅。  
  - 図解・画面キャプチャ多用。  
  - 目次・索引付き。

##### 8.4.1.4 管理画面推奨動作環境
- **要件（再掲）** 
  Google Chrome・Microsoft Edge最新版。

- **実現方法**  
  - 動作検証徹底。  
  - 推奨外利用時は警告表示。  
  - バージョンアップ対応を運用計画に組込。

#### 8.4.2 拡張性

##### 8.4.2.1 外部API・プラグイン連携
- **要件（再掲）** 
  SNSや分析ツールと連携可能。

- **実現方法**  
  - RESTful API採用。  
  - プラグイン方式設計。  
  - API仕様書（OpenAPI）整備。

##### 8.4.2.2 マルチデバイス対応
- **（再掲）**
  375px以上の幅で表示崩れなし。

- **実現方法**  
  - レスポンシブWebデザイン採用。  
  - 最新安定版ブラウザで検証。  
  - 柔軟なレイアウト設計。

##### 8.4.2.3 将来的な機能追加への備え
- **要件（再掲）**
  海外展開・定期購入対応可能。

- **実現方法**  
  - 拡張性重視の設計（多言語・多通貨対応含む）。  
  - マイクロサービス・クラウド活用検討。  
  - 設定値・文言外部化。

---

### 8.5 開発環境・実行環境詳細

#### 8.5.1 開発環境
- OS: Windows 10 / macOS 最新版  
- IDE: Visual Studio Code 最新版  
- バージョン管理: Git (GitHub利用)  
- 言語・フレームワーク:  
  - フロントエンド: React 18.x / Vue 3.x  
  - バックエンド: Spring Boot 2.7.x / Node.js 18.x  
- DB: PostgreSQL 14.x  
- コンテナ: Docker 20.x

#### 8.5.2 実行環境（本番・ステージング）
- OS: Amazon Linux 2  
- Webサーバー: Nginx 1.22.x  
- アプリケーションサーバー: Java 11 (OpenJDK) / Node.js 18.x  
- DB: Amazon RDS PostgreSQL 14.x  
- キャッシュ: Redis 6.x  
- CDN: AWS CloudFront  
- ログ収集: AWS CloudWatch Logs  

---

### 8.6 セキュリティ設定詳細（Spring Security例）

- 認証方式: JWTトークン認証  
- パスワードハッシュ化: bcrypt採用  
- CSRF対策: Spring SecurityのCSRFトークン利用  
- ログイン失敗制限: 5回失敗で15分ロックをDBで管理  
- 権限管理: Roleベースのアクセス制御（ADMIN/USER等）

---

### 8.7 ログフォーマット例

```json
{
  "timestamp": "2025-07-04T12:34:56Z",
  "level": "INFO",
  "service": "order-service",
  "event": "OrderCreated",
  "userId": "user123",
  "orderId": "order789",
  "message": "注文が正常に作成されました"
}
```
---

### 8.8 監視項目一覧

| 項目             | 監視内容                   | 閾値        | 通知方法  |
|------------------|----------------------------|-------------|-----------|
| サイト応答時間   | HTTPレスポンス時間         | 1.5秒以上   | メール    |
| CPU使用率        | CPU使用率                 | 80%以上     | メール    |
| メモリ使用率     | メモリ使用率              | 80%以上     | メール    |
| ディスク使用率   | ディスク使用率            | 80%以上     | メール    |
| バックアップ成否 | バックアップ処理成功/失敗 | 失敗時      | メール    |
| 外部API応答      | 外部連携サービス正常応答  | エラー発生時| メール    |

---

### 8.9 バックアップ・リストア手順概要

#### 8.9.1 バックアップ

```bash
# RDSのスナップショット自動取得（AWS CLI例）
aws rds create-db-snapshot --db-instance-identifier mydbinstance --db-snapshot-identifier mydb-snapshot-$(date +%Y%m%d)

# バックアップデータは暗号化し30日間保存
# 監視ツールでバックアップ処理失敗時に管理者へ通知

```
---
#### 8.9.2 リストア
```bash
# 最新正常スナップショットからの復元（AWS CLI例）
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier mydbinstance-restore --db-snapshot-identifier mydb-snapshot-YYYYMMDD

# ステージング環境で定期テスト実施
# 障害発生時は2時間以内の復旧を目標
```