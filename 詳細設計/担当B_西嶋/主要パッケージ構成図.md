# ECサイト パッケージ構成ツリー

```
src/
└── main/
    └── java/
        └── com/
            └── ecommerce/
                ├── common/
                │   ├── exception/
                │   │   ├── BaseException.java
                │   │   └── ErrorResponse.java
                │   └── config/
                │       ├── SessionConfig.java
                │       └── WebConfig.java
                │
                ├── product/
                │   ├── entity/
                │   │   ├── Product.java
                │   │   │   ├── isInStock()
                │   │   │   ├── hasStock(int quantity)
                │   │   │   ├── reduceStock(int quantity)
                │   │   │   ├── increaseStock(int quantity)
                │   │   │   └── validateStock(int quantity)
                │   │   └── Category.java
                │   │
                │   ├── repository/
                │   │   ├── ProductRepository.java
                │   │   │   ├── findAll()
                │   │   │   ├── findById(int id)
                │   │   │   ├── findByCategory(int categoryId)
                │   │   │   ├── findByNameContaining(string keyword)
                │   │   │   ├── findByStockQuantityGreaterThan(int quantity)
                │   │   │   ├── save(Product product)
                │   │   │   └── deleteById(int id)
                │   │   └── CategoryRepository.java
                │   │       ├── findAll()
                │   │       ├── findById(int id)
                │   │       ├── save(Category category)
                │   │       └── deleteById(int id)
                │   │
                │   ├── service/
                │   │   ├── ProductService.java
                │   │   │   ├── getAllProducts()
                │   │   │   ├── getAvailableProducts()
                │   │   │   ├── getProductById(int id)
                │   │   │   ├── getProductsByCategory(int categoryId)
                │   │   │   ├── searchProducts(string keyword)
                │   │   │   ├── createProduct(ProductCreateDTO dto)
                │   │   │   ├── updateProduct(int id, ProductUpdateDTO dto)
                │   │   │   ├── deleteProduct(int id)
                │   │   │   └── validateStockAvailability(int id, int quantity)
                │   │   └── CategoryService.java
                │   │       ├── getAllCategories()
                │   │       ├── getCategoryById(int id)
                │   │       ├── createCategory(CategoryCreateDTO dto)
                │   │       ├── updateCategory(int id, CategoryUpdateDTO dto)
                │   │       └── deleteCategory(int id)
                │   │
                │   ├── controller/
                │   │   ├── ProductController.java
                │   │   │   ├── getProducts()
                │   │   │   ├── getProduct(int id)
                │   │   │   ├── getProductsByCategory(int categoryId)
                │   │   │   ├── searchProducts(string keyword)
                │   │   │   ├── createProduct(ProductCreateDTO dto)
                │   │   │   ├── updateProduct(int id, ProductUpdateDTO dto)
                │   │   │   ├── deleteProduct(int id)
                │   │   │   └── checkStock(int id)
                │   │   └── CategoryController.java
                │   │       ├── getCategories()
                │   │       ├── getCategory(int id)
                │   │       ├── createCategory(CategoryCreateDTO dto)
                │   │       ├── updateCategory(int id, CategoryUpdateDTO dto)
                │   │       └── deleteCategory(int id)
                │   │
                │   ├── dto/
                │   │   ├── ProductDTO.java
                │   │   ├── ProductCreateDTO.java
                │   │   ├── ProductUpdateDTO.java
                │   │   ├── CategoryDTO.java
                │   │   ├── CategoryCreateDTO.java
                │   │   └── CategoryUpdateDTO.java
                │   │
                │   └── exception/
                │       ├── ProductNotFoundException.java
                │       ├── InsufficientStockException.java
                │       └── OutOfStockException.java
                │
                ├── cart/
                │   ├── session/
                │   │   ├── CartSession.java
                │   │   │   ├── addItem(int product_id, int quantity)
                │   │   │   ├── removeItem(int product_id)
                │   │   │   ├── updateQuantity(int product_id, int quantity)
                │   │   │   ├── getTotalPrice()
                │   │   │   ├── getItemCount()
                │   │   │   ├── clear()
                │   │   │   ├── validateAllItemsStock()
                │   │   │   ├── hasItem(int product_id)
                │   │   │   └── getItem(int product_id)
                │   │   └── CartItemSession.java
                │   │       ├── getSubtotal()
                │   │       ├── validateStock()
                │   │       └── updateQuantity(int quantity)
                │   │
                │   ├── service/
                │   │   └── CartService.java
                │   │       ├── getCart(HttpSession session)
                │   │       ├── addToCart(HttpSession session, int productId, int quantity)
                │   │       ├── removeFromCart(HttpSession session, int productId)
                │   │       ├── updateCartItem(HttpSession session, int productId, int quantity)
                │   │       ├── clearCart(HttpSession session)
                │   │       ├── getCartItemCount(HttpSession session)
                │   │       ├── validateProductStock(int productId, int quantity)
                │   │       ├── validateCartStock(HttpSession session)
                │   │       ├── refreshCartAvailability(HttpSession session)
                │   │       ├── getCartSession(HttpSession session)
                │   │       └── saveCartSession(HttpSession session, CartSession cart)
                │   │
                │   ├── controller/
                │   │   └── CartController.java
                │   │       ├── getCart(HttpSession session)
                │   │       ├── addToCart(HttpSession session, CartAddDTO dto)
                │   │       ├── removeFromCart(HttpSession session, int productId)
                │   │       ├── updateCartItem(HttpSession session, CartUpdateDTO dto)
                │   │       ├── clearCart(HttpSession session)
                │   │       ├── getCartItemCount(HttpSession session)
                │   │       └── validateCart(HttpSession session)
                │   │
                │   ├── dto/
                │   │   ├── CartDTO.java
                │   │   ├── CartItemDTO.java
                │   │   ├── CartAddDTO.java
                │   │   └── CartUpdateDTO.java
                │   │
                │   └── exception/
                │       ├── CartItemNotFoundException.java
                │       └── CartValidationException.java
                │
                ├── order/
                │   ├── entity/
                │   │   ├── Order.java
                │   │   │   ├── calculateTotal()
                │   │   │   ├── changeStatus(string status)
                │   │   │   ├── canCancel()
                │   │   │   ├── canShip()
                │   │   │   └── validateOrder()
                │   │   └── OrderItem.java
                │   │       ├── calculateSubtotal()
                │   │       └── validateQuantity()
                │   │
                │   ├── repository/
                │   │   ├── OrderRepository.java
                │   │   │   ├── findAll()
                │   │   │   ├── findById(int id)
                │   │   │   ├── findByCustomerEmail(string email)
                │   │   │   ├── findByOrderStatus(string status)
                │   │   │   ├── findByOrderDateBetween(datetime start, datetime end)
                │   │   │   ├── save(Order order)
                │   │   │   └── deleteById(int id)
                │   │   └── OrderItemRepository.java
                │   │       ├── findByOrderId(int orderId)
                │   │       ├── findByProductId(int productId)
                │   │       ├── save(OrderItem orderItem)
                │   │       └── deleteById(int id)
                │   │
                │   ├── service/
                │   │   └── OrderService.java
                │   │       ├── createOrder(OrderCreateDTO dto)
                │   │       ├── getOrderById(int id)
                │   │       ├── getAllOrders()
                │   │       ├── getOrdersByCustomer(string email)
                │   │       ├── getOrdersByStatus(string status)
                │   │       ├── updateOrderStatus(int id, string status)
                │   │       ├── cancelOrder(int id)
                │   │       ├── completeOrder(int id)
                │   │       ├── processCheckout(string sessionId, OrderCreateDTO dto)
                │   │       └── validateOrderItems(List<OrderItemCreateDTO> items)
                │   │
                │   ├── controller/
                │   │   └── OrderController.java
                │   │       ├── createOrder(OrderCreateDTO dto)
                │   │       ├── getOrder(int id)
                │   │       ├── getAllOrders()
                │   │       ├── getOrdersByCustomer(string email)
                │   │       ├── getOrdersByStatus(string status)
                │   │       ├── updateOrderStatus(int id, OrderStatusUpdateDTO dto)
                │   │       ├── cancelOrder(int id)
                │   │       └── checkout(HttpSession session, OrderCreateDTO dto)
                │   │
                │   ├── dto/
                │   │   ├── OrderDTO.java
                │   │   ├── OrderCreateDTO.java
                │   │   ├── OrderItemDTO.java
                │   │   ├── OrderItemCreateDTO.java
                │   │   └── OrderStatusUpdateDTO.java
                │   │
                │   └── exception/
                │       ├── OrderNotFoundException.java
                │       ├── OrderValidationException.java
                │       └── OrderCancellationException.java
                │
                ├── shipping/
                │   ├── entity/
                │   │   └── ShippingSetting.java
                │   │       ├── getShippingFee()
                │   │       ├── activate()
                │   │       ├── deactivate()
                │   │       └── isValidSetting()
                │   │
                │   ├── repository/
                │   │   └── ShippingSettingRepository.java
                │   │       ├── findByIsActiveTrue()
                │   │       ├── findAll()
                │   │       ├── findById(int id)
                │   │       ├── save(ShippingSetting shippingSetting)
                │   │       ├── deleteById(int id)
                │   │       └── findByOrderByCreatedAtDesc()
                │   │
                │   ├── service/
                │   │   └── ShippingService.java
                │   │       ├── getCurrentShippingSetting()
                │   │       ├── updateShippingSetting(ShippingSettingUpdateDTO dto)
                │   │       ├── getShippingFee()
                │   │       ├── createShippingSetting(ShippingSettingCreateDTO dto)
                │   │       ├── getAllShippingSettings()
                │   │       ├── activateShippingSetting(int id)
                │   │       ├── deactivateShippingSetting(int id)
                │   │       └── validateShippingSetting(ShippingSettingCreateDTO dto)
                │   │
                │   ├── controller/
                │   │   └── ShippingController.java
                │   │       ├── getCurrentSetting()
                │   │       ├── updateSetting(ShippingSettingUpdateDTO dto)
                │   │       ├── getShippingFee()
                │   │       ├── createSetting(ShippingSettingCreateDTO dto)
                │   │       ├── getAllSettings()
                │   │       ├── activateSetting(int id)
                │   │       └── deactivateSetting(int id)
                │   │
                │   ├── dto/
                │   │   ├── ShippingSettingDTO.java
                │   │   ├── ShippingSettingCreateDTO.java
                │   │   └── ShippingSettingUpdateDTO.java
                │   │
                │   └── exception/
                │       ├── ShippingSettingNotFoundException.java
                │       └── ShippingSettingValidationException.java
                │
                ├── admin/
                │   ├── entity/
                │   │   ├── Admin.java
                │   │   │   ├── isActive()
                │   │   │   ├── activate()
                │   │   │   ├── deactivate()
                │   │   │   ├── updateLastLogin()
                │   │   │   ├── hasRole(string role)
                │   │   │   └── changePassword(string newPassword)
                │   │   └── AdminSession.java
                │   │       ├── isExpired()
                │   │       ├── extend()
                │   │       ├── invalidate()
                │   │       └── hasPermission(string permission)
                │   │
                │   ├── repository/
                │   │   ├── AdminRepository.java
                │   │   │   ├── findAll()
                │   │   │   ├── findById(int id)
                │   │   │   ├── findByUsername(string username)
                │   │   │   ├── findByEmail(string email)
                │   │   │   ├── findByIsActiveTrue()
                │   │   │   ├── findByRole(string role)
                │   │   │   ├── save(Admin admin)
                │   │   │   └── deleteById(int id)
                │   │   └── AdminSessionRepository.java
                │   │       ├── findBySessionId(string sessionId)
                │   │       ├── findByAdminId(int adminId)
                │   │       ├── findByIsActiveTrue()
                │   │       ├── save(AdminSession session)
                │   │       ├── deleteById(string sessionId)
                │   │       └── deleteByAdminId(int adminId)
                │   │
                │   ├── service/
                │   │   ├── AdminAuthService.java
                │   │   │   ├── login(AdminLoginDTO dto)
                │   │   │   ├── logout(string sessionId)
                │   │   │   ├── validateSession(string sessionId)
                │   │   │   ├── refreshSession(string sessionId)
                │   │   │   ├── getCurrentAdmin(string sessionId)
                │   │   │   ├── hasPermission(string sessionId, string permission)
                │   │   │   ├── changePassword(string sessionId, AdminPasswordChangeDTO dto)
                │   │   │   └── invalidateAllSessions(int adminId)
                │   │   └── AdminService.java
                │   │       ├── getAllAdmins()
                │   │       ├── getAdminById(int id)
                │   │       ├── createAdmin(AdminCreateDTO dto)
                │   │       ├── updateAdmin(int id, AdminUpdateDTO dto)
                │   │       ├── deleteAdmin(int id)
                │   │       ├── activateAdmin(int id)
                │   │       ├── deactivateAdmin(int id)
                │   │       └── resetPassword(int id, string newPassword)
                │   │
                │   ├── controller/
                │   │   ├── AdminAuthController.java
                │   │   │   ├── login(AdminLoginDTO dto)
                │   │   │   ├── logout(HttpSession session)
                │   │   │   ├── validateSession(HttpSession session)
                │   │   │   ├── getCurrentAdmin(HttpSession session)
                │   │   │   ├── changePassword(HttpSession session, AdminPasswordChangeDTO dto)
                │   │   │   └── invalidateAllSessions(HttpSession session)
                │   │   └── AdminController.java
                │   │       ├── getAllAdmins()
                │   │       ├── getAdmin(int id)
                │   │       ├── createAdmin(AdminCreateDTO dto)
                │   │       ├── updateAdmin(int id, AdminUpdateDTO dto)
                │   │       ├── deleteAdmin(int id)
                │   │       ├── activateAdmin(int id)
                │   │       ├── deactivateAdmin(int id)
                │   │       └── resetPassword(int id, AdminPasswordResetDTO dto)
                │   │
                │   ├── dto/
                │   │   ├── AdminDTO.java
                │   │   ├── AdminCreateDTO.java
                │   │   ├── AdminUpdateDTO.java
                │   │   ├── AdminLoginDTO.java
                │   │   ├── AdminSessionDTO.java
                │   │   ├── AdminPasswordChangeDTO.java
                │   │   └── AdminPasswordResetDTO.java
                │   │
                │   └── exception/
                │       ├── AdminNotFoundException.java
                │       ├── AdminAuthenticationException.java
                │       ├── AdminSessionExpiredException.java
                │       └── AdminPermissionDeniedException.java
                │
                └── inquiry/
                    ├── entity/
                    │   └── Inquiry.java
                    │       ├── markAsResolved()
                    │       ├── reopen()
                    │       ├── addResponse(string response, int adminUserId)
                    │       ├── isResolved()
                    │       └── requiresResponse()
                    │
                    ├── repository/
                    │   └── InquiryRepository.java
                    │       ├── findAll()
                    │       ├── findById(int id)
                    │       ├── findByStatus(string status)
                    │       ├── findByCategory(string category)
                    │       ├── findBySubmittedAtBetween(datetime start, datetime end)
                    │       ├── findByEmail(string email)
                    │       ├── findByAdminUserId(int adminUserId)
                    │       ├── save(Inquiry inquiry)
                    │       └── deleteById(int id)
                    │
                    ├── service/
                    │   └── InquiryService.java
                    │       ├── createInquiry(InquiryCreateDTO dto)
                    │       ├── getInquiryById(int id)
                    │       ├── getAllInquiries()
                    │       ├── getInquiriesByStatus(string status)
                    │       ├── getInquiriesByCategory(string category)
                    │       ├── getInquiriesByEmail(string email)
                    │       ├── updateInquiryStatus(int id, string status)
                    │       ├── addResponse(int id, string response, int adminUserId)
                    │       ├── deleteInquiry(int id)
                    │       ├── getUnrespondedInquiries()
                    │       └── sendNotificationEmail(int inquiryId)
                    │
                    ├── controller/
                    │   └── InquiryController.java
                    │       ├── createInquiry(InquiryCreateDTO dto)
                    │       ├── getInquiry(int id)
                    │       ├── getAllInquiries()
                    │       ├── getInquiriesByStatus(string status)
                    │       ├── getInquiriesByCategory(string category)
                    │       ├── getMyInquiries(string email)
                    │       ├── updateInquiryStatus(int id, InquiryStatusUpdateDTO dto)
                    │       ├── addResponse(int id, InquiryResponseDTO dto)
                    │       ├── deleteInquiry(int id)
                    │       └── getUnrespondedInquiries()
                    │
                    ├── dto/
                    │   ├── InquiryDTO.java
                    │   ├── InquiryCreateDTO.java
                    │   ├── InquiryStatusUpdateDTO.java
                    │   └── InquiryResponseDTO.java
                    │
                    └── exception/
                        ├── InquiryNotFoundException.java
                        ├── InvalidInquiryStatusException.java
                        └── InquiryValidationException.java
```

## パッケージ構成の特徴

### 1. 機能別パッケージ構成
- **product**: 商品・カテゴリ管理
- **cart**: カート機能（セッション管理）
- **order**: 注文・購入処理
- **shipping**: 配送設定管理
- **admin**: 管理者認証・管理
- **inquiry**: 問い合わせ機能

### 2. 各機能内のレイヤー構成
- **entity**: データベースエンティティ
- **session**: セッション管理クラス（カートのみ）
- **repository**: データアクセス層
- **service**: ビジネスロジック層
- **controller**: コントローラー層
- **dto**: データ転送オブジェクト
- **exception**: カスタム例外クラス

### 3. 共通パッケージ
- **common**: 全体で使用する共通クラス
  - **exception**: 基底例外クラス
  - **config**: 設定クラス

### 4. 設計上の特徴
- **単一責任原則**: 各クラスが明確な責任を持つ
- **レイヤー分離**: 各層が適切に分離されている
- **依存関係**: 上位層から下位層への依存のみ
- **例外処理**: 機能固有の例外を適切に配置