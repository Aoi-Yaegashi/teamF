# 商品機能
```mermaid

classDiagram
    %% 商品機能
    class Product {
        +int id
        +string name
        +string description
        +int price
        +int sale_price
        +string image_url
        +int stock_quantity
        +bool is_published
        +int category_id
        +datetime created_at
        +datetime updated_at
        
        +bool isInStock()
        +void reduceStock(int quantity)
        +void increaseStock(int quantity)
    }
    
    class Category {
        +int id
        +string name
        +string description
        +datetime created_at
        +datetime updated_at
    }
    
    class ProductRepository {
        <<interface>>
        +List~Product~ findAll()
        +Optional~Product~ findById(int id)
        +List~Product~ findByCategory(int categoryId)
        +List~Product~ findByNameContaining(string keyword)
        +List~Product~ findByIsPublishedTrue()
        +Product save(Product product)
        +void deleteById(int id)
    }
    
    class CategoryRepository {
        <<interface>>
        +List~Category~ findAll()
        +Optional~Category~ findById(int id)
        +Category save(Category category)
        +void deleteById(int id)
    }
    
    class ProductService {
        +List~ProductDTO~ getAllProducts()
        +List~ProductDTO~ getPublishedProducts()
        +ProductDTO getProductById(int id)
        +List~ProductDTO~ getProductsByCategory(int categoryId)
        +List~ProductDTO~ searchProducts(string keyword)
        +ProductDTO createProduct(ProductCreateDTO dto)
        +ProductDTO updateProduct(int id, ProductUpdateDTO dto)
        +void deleteProduct(int id)
        +void updateStock(int id, int quantity)
    }
    
    class ProductController {
        +ResponseEntity~List~ProductDTO~~ getProducts()
        +ResponseEntity~ProductDTO~ getProduct(int id)
        +ResponseEntity~List~ProductDTO~~ getProductsByCategory(int categoryId)
        +ResponseEntity~List~ProductDTO~~ searchProducts(string keyword)
        +ResponseEntity~ProductDTO~ createProduct(ProductCreateDTO dto)
        +ResponseEntity~ProductDTO~ updateProduct(int id, ProductUpdateDTO dto)
        +ResponseEntity~Void~ deleteProduct(int id)
    }
    
    class ProductDTO {
        +int id
        +string name
        +string description
        +int price
        +int sale_price
        +string image_url
        +bool is_published
        +string category_name
    }
    
    class ProductCreateDTO {
        +string name
        +string description
        +int price
        +int sale_price
        +string image_url
        +int stock_quantity
        +int category_id
    }
    
    class ProductUpdateDTO {
        +string name
        +string description
        +int price
        +int sale_price
        +string image_url
        +int stock_quantity
        +bool is_published
        +int category_id
    }
    
    %% 関係
    Product o-- Category : "belongs to"
    ProductRepository --> Product : "manages"
    CategoryRepository --> Category : "manages"
    ProductService --> ProductRepository : "uses"
    ProductService --> CategoryRepository : "uses"
    ProductController --> ProductService : "uses"
    ProductService --> ProductDTO : "creates"
    ProductController --> ProductCreateDTO : "receives"
    ProductController --> ProductUpdateDTO : "receives"

```

# カート機能

```mermaid

classDiagram
    %% カート機能（セッション管理）
    class Cart {
        +string session_id
        +List~CartItem~ items
        +datetime created_at
        +datetime updated_at
        
        +void addItem(int product_id, int quantity)
        +void removeItem(int product_id)
        +void updateQuantity(int product_id, int quantity)
        +int getTotalPrice()
        +int getItemCount()
        +void clear()
    }
    
    class CartItem {
        +int product_id
        +string product_name
        +int unit_price
        +int quantity
        +string image_url
        
        +int getSubtotal()
    }
    
    class CartService {
        +CartDTO getCart(string sessionId)
        +CartDTO addToCart(string sessionId, int productId, int quantity)
        +CartDTO removeFromCart(string sessionId, int productId)
        +CartDTO updateCartItem(string sessionId, int productId, int quantity)
        +void clearCart(string sessionId)
        +int getCartItemCount(string sessionId)
    }
    
    class CartController {
        +ResponseEntity~CartDTO~ getCart(HttpSession session)
        +ResponseEntity~CartDTO~ addToCart(HttpSession session, CartAddDTO dto)
        +ResponseEntity~CartDTO~ removeFromCart(HttpSession session, int productId)
        +ResponseEntity~CartDTO~ updateCartItem(HttpSession session, CartUpdateDTO dto)
        +ResponseEntity~Void~ clearCart(HttpSession session)
        +ResponseEntity~Integer~ getCartItemCount(HttpSession session)
    }
    
    class CartDTO {
        +string session_id
        +List~CartItemDTO~ items
        +int total_price
        +int item_count
    }
    
    class CartItemDTO {
        +int product_id
        +string product_name
        +int unit_price
        +int quantity
        +string image_url
        +int subtotal
    }
    
    class CartAddDTO {
        +int product_id
        +int quantity
    }
    
    class CartUpdateDTO {
        +int product_id
        +int quantity
    }
    
    %% 関係
    Cart --o CartItem : "contains"
    CartService --> Cart : "manages"
    CartController --> CartService : "uses"
    CartService --> CartDTO : "creates"
    CartController --> CartAddDTO : "receives"
    CartController --> CartUpdateDTO : "receives"

```

# 注文機能
```mermaid

classDiagram
    %% 注文機能
    class Order {
        +int id
        +string session_id
        +string last_name
        +string first_name
        +string postal_code
        +string address
        +string phone_number
        +string email
        +string payment_method
        +datetime ordered_at
        +string status
        +int shipping_fee
        +int total_amount
        
        +void confirm()
        +void cancel()
        +void ship()
        +void complete()
        +int calculateTotal()
    }
    
    class OrderItem {
        +int id
        +int order_id
        +int product_id
        +string product_name
        +int quantity
        +int unit_price
        +int subtotal
        
        +int getSubtotal()
    }
    
    class OrderRepository {
        <<interface>>
        +List~Order~ findAll()
        +Optional~Order~ findById(int id)
        +List~Order~ findBySessionId(string sessionId)
        +List~Order~ findByStatus(string status)
        +List~Order~ findByOrderedAtBetween(datetime start, datetime end)
        +Order save(Order order)
        +void deleteById(int id)
    }
    
    class OrderItemRepository {
        <<interface>>
        +List~OrderItem~ findByOrderId(int orderId)
        +OrderItem save(OrderItem orderItem)
        +void deleteById(int id)
    }
    
    class OrderService {
        +OrderDTO createOrder(OrderCreateDTO dto)
        +OrderDTO getOrderById(int id)
        +List~OrderDTO~ getOrdersBySessionId(string sessionId)
        +List~OrderDTO~ getAllOrders()
        +OrderDTO updateOrderStatus(int id, string status)
        +void cancelOrder(int id)
        +List~OrderDTO~ getOrdersByDateRange(datetime start, datetime end)
    }
    
    class OrderController {
        +ResponseEntity~OrderDTO~ createOrder(OrderCreateDTO dto)
        +ResponseEntity~OrderDTO~ getOrder(int id)
        +ResponseEntity~List~OrderDTO~~ getMyOrders(HttpSession session)
        +ResponseEntity~List~OrderDTO~~ getAllOrders()
        +ResponseEntity~OrderDTO~ updateOrderStatus(int id, OrderStatusUpdateDTO dto)
        +ResponseEntity~Void~ cancelOrder(int id)
    }
    
    class OrderDTO {
        +int id
        +string session_id
        +string customer_name
        +string address
        +string phone_number
        +string email
        +string payment_method
        +datetime ordered_at
        +string status
        +int shipping_fee
        +int total_amount
        +List~OrderItemDTO~ items
    }
    
    class OrderItemDTO {
        +int id
        +int product_id
        +string product_name
        +int quantity
        +int unit_price
        +int subtotal
    }
    
    class OrderCreateDTO {
        +string session_id
        +string last_name
        +string first_name
        +string postal_code
        +string address
        +string phone_number
        +string email
        +string payment_method
        +List~OrderItemCreateDTO~ items
    }
    
    class OrderItemCreateDTO {
        +int product_id
        +string product_name
        +int quantity
        +int unit_price
    }
    
    class OrderStatusUpdateDTO {
        +string status
    }
    
    %% 関係
    Order --o OrderItem : "contains"
    OrderRepository --> Order : "manages"
    OrderItemRepository --> OrderItem : "manages"
    OrderService --> OrderRepository : "uses"
    OrderService --> OrderItemRepository : "uses"
    OrderController --> OrderService : "uses"
    OrderService --> OrderDTO : "creates"
    OrderController --> OrderCreateDTO : "receives"
    OrderController --> OrderStatusUpdateDTO : "receives"

```

# 管理者認証機能
```mermaid

classDiagram
    %% 管理者認証機能
    class AdminUser {
        +int id
        +string username
        +string password_hash
        +string role
        +string email
        +datetime last_login
        +bool is_active
        +datetime created_at
        +datetime updated_at
        
        +bool authenticate(string password)
        +void changePassword(string newPassword)
        +bool hasPermission(string action)
        +void updateLastLogin()
    }
    
    class AdminUserRepository {
        <<interface>>
        +Optional~AdminUser~ findByUsername(string username)
        +Optional~AdminUser~ findByEmail(string email)
        +List~AdminUser~ findAll()
        +Optional~AdminUser~ findById(int id)
        +AdminUser save(AdminUser adminUser)
        +void deleteById(int id)
        +List~AdminUser~ findByIsActiveTrue()
    }
    
    class AdminAuthService {
        +AdminUserDTO authenticate(string username, string password)
        +AdminUserDTO getCurrentUser(int userId)
        +void logout(int userId)
        +AdminUserDTO createAdminUser(AdminUserCreateDTO dto)
        +AdminUserDTO updateAdminUser(int id, AdminUserUpdateDTO dto)
        +void changePassword(int userId, string oldPassword, string newPassword)
        +void deactivateUser(int userId)
        +List~AdminUserDTO~ getAllAdminUsers()
    }
    
    class AdminAuthController {
        +ResponseEntity~AdminUserDTO~ login(AdminLoginDTO dto)
        +ResponseEntity~Void~ logout(HttpSession session)
        +ResponseEntity~AdminUserDTO~ getCurrentUser(HttpSession session)
        +ResponseEntity~AdminUserDTO~ createAdminUser(AdminUserCreateDTO dto)
        +ResponseEntity~AdminUserDTO~ updateAdminUser(int id, AdminUserUpdateDTO dto)
        +ResponseEntity~Void~ changePassword(AdminPasswordChangeDTO dto)
        +ResponseEntity~List~AdminUserDTO~~ getAllAdminUsers()
    }
    
    class AdminUserDTO {
        +int id
        +string username
        +string role
        +string email
        +datetime last_login
        +bool is_active
        +datetime created_at
    }
    
    class AdminLoginDTO {
        +string username
        +string password
    }
    
    class AdminUserCreateDTO {
        +string username
        +string password
        +string role
        +string email
    }
    
    class AdminUserUpdateDTO {
        +string username
        +string role
        +string email
        +bool is_active
    }
    
    class AdminPasswordChangeDTO {
        +int user_id
        +string old_password
        +string new_password
    }
    
    %% 関係
    AdminUserRepository --> AdminUser : "manages"
    AdminAuthService --> AdminUserRepository : "uses"
    AdminAuthController --> AdminAuthService : "uses"
    AdminAuthService --> AdminUserDTO : "creates"
    AdminAuthController --> AdminLoginDTO : "receives"
    AdminAuthController --> AdminUserCreateDTO : "receives"
    AdminAuthController --> AdminUserUpdateDTO : "receives"
    AdminAuthController --> AdminPasswordChangeDTO : "receives"

```

# 問い合わせ機能
```mermaid

classDiagram
    %% 問い合わせ機能
    class Inquiry {
        +int id
        +string name
        +string email
        +string category
        +string message
        +datetime submitted_at
        +string status
        +string admin_response
        +datetime responded_at
        +int admin_user_id
        
        +void markAsResolved()
        +void reopen()
        +void addResponse(string response, int adminUserId)
    }
    
    class InquiryRepository {
        <<interface>>
        +List~Inquiry~ findAll()
        +Optional~Inquiry~ findById(int id)
        +List~Inquiry~ findByStatus(string status)
        +List~Inquiry~ findByCategory(string category)
        +List~Inquiry~ findBySubmittedAtBetween(datetime start, datetime end)
        +Inquiry save(Inquiry inquiry)
        +void deleteById(int id)
    }
    
    class InquiryService {
        +InquiryDTO createInquiry(InquiryCreateDTO dto)
        +InquiryDTO getInquiryById(int id)
        +List~InquiryDTO~ getAllInquiries()
        +List~InquiryDTO~ getInquiriesByStatus(string status)
        +List~InquiryDTO~ getInquiriesByCategory(string category)
        +InquiryDTO updateInquiryStatus(int id, string status)
        +InquiryDTO addResponse(int id, string response, int adminUserId)
        +void deleteInquiry(int id)
    }
    
    class InquiryController {
        +ResponseEntity~InquiryDTO~ createInquiry(InquiryCreateDTO dto)
        +ResponseEntity~InquiryDTO~ getInquiry(int id)
        +ResponseEntity~List~InquiryDTO~~ getAllInquiries()
        +ResponseEntity~List~InquiryDTO~~ getInquiriesByStatus(string status)
        +ResponseEntity~InquiryDTO~ updateInquiryStatus(int id, InquiryStatusUpdateDTO dto)
        +ResponseEntity~InquiryDTO~ addResponse(int id, InquiryResponseDTO dto)
        +ResponseEntity~Void~ deleteInquiry(int id)
    }
    
    class InquiryDTO {
        +int id
        +string name
        +string email
        +string category
        +string message
        +datetime submitted_at
        +string status
        +string admin_response
        +datetime responded_at
        +string admin_username
    }
    
    class InquiryCreateDTO {
        +string name
        +string email
        +string category
        +string message
    }
    
    class InquiryStatusUpdateDTO {
        +string status
    }
    
    class InquiryResponseDTO {
        +string response
        +int admin_user_id
    }
    
    %% 関係
    InquiryRepository --> Inquiry : "manages"
    InquiryService --> InquiryRepository : "uses"
    InquiryController --> InquiryService : "uses"
    InquiryService --> InquiryDTO : "creates"
    InquiryController --> InquiryCreateDTO : "receives"
    InquiryController --> InquiryStatusUpdateDTO : "receives"
    InquiryController --> InquiryResponseDTO : "receives"

```

# 配送設定機能
```mermaid

classDiagram
    %% 配送設定機能
    class ShippingSetting {
        +int id
        +int flat_rate
        +int free_shipping_threshold
        +bool is_active
        +datetime created_at
        +datetime updated_at
        
        +int calculateShippingFee(int orderAmount)
        +bool isFreeShipping(int orderAmount)
    }
    
    class ShippingSettingRepository {
        <<interface>>
        +Optional~ShippingSetting~ findByIsActiveTrue()
        +List~ShippingSetting~ findAll()
        +Optional~ShippingSetting~ findById(int id)
        +ShippingSetting save(ShippingSetting shippingSetting)
        +void deleteById(int id)
    }
    
    class ShippingService {
        +ShippingSettingDTO getCurrentShippingSetting()
        +ShippingSettingDTO updateShippingSetting(ShippingSettingUpdateDTO dto)
        +int calculateShippingFee(int orderAmount)
        +ShippingSettingDTO createShippingSetting(ShippingSettingCreateDTO dto)
        +List~ShippingSettingDTO~ getAllShippingSettings()
        +void activateShippingSetting(int id)
    }
    
    class ShippingController {
        +ResponseEntity~ShippingSettingDTO~ getCurrentSetting()
        +ResponseEntity~ShippingSettingDTO~ updateSetting(ShippingSettingUpdateDTO dto)
        +ResponseEntity~Integer~ calculateShippingFee(int orderAmount)
        +ResponseEntity~ShippingSettingDTO~ createSetting(ShippingSettingCreateDTO dto)
        +ResponseEntity~List~ShippingSettingDTO~~ getAllSettings()
        +ResponseEntity~Void~ activateSetting(int id)
    }
    
    class ShippingSettingDTO {
        +int id
        +int flat_rate
        +int free_shipping_threshold
        +bool is_active
        +datetime created_at
        +datetime updated_at
    }
    
    class ShippingSettingCreateDTO {
        +int flat_rate
        +int free_shipping_threshold
    }
    
    class ShippingSettingUpdateDTO {
        +int flat_rate
        +int free_shipping_threshold
        +bool is_active
    }
    
    %% 関係
    ShippingSettingRepository --> ShippingSetting : "manages"
    ShippingService --> ShippingSettingRepository : "uses"
    ShippingController --> ShippingService : "uses"
    ShippingService --> ShippingSettingDTO : "creates"
    ShippingController --> ShippingSettingCreateDTO : "receives"
    ShippingController --> ShippingSettingUpdateDTO : "receives"

    ```